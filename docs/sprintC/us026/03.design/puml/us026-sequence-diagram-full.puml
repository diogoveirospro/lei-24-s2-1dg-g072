@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

autonumber

actor "Green Space\n Manager" as GSM
participant ":AssignVehicleUI" as UI
participant ":AssignVehicleController" as CTRL
participant "repositories\n:Repositories" as REP
participant "agenda\n:Agenda" as AGENDA
participant ":AgendaMapper" as AGENDAMAPPER
participant "agendaEntry\n:AgendaEntry" as AGENDAENTRY
participant "listEntries\n:List<AgendaEntry>" as LISTENTRIES
participant "agendaEntriesDto\n:List<AgendaEntryDto>" as AGENDAENTRIESDTO
participant "agendaEntryDto\n:AgendaDto" as AGENDAENTRYDTO
participant "vehicleRepository\n:VehicleRepository" as VEHICLEREP
participant "vehicleRepositoryMapper\n:VehicleRepositoryMapper" as VEHICLEREPMAPPER
participant "vehicle\n:Vehicle" as VEHICLE
participant "listVehicles\n:List<Vehicle>" as LISTVEHICLE
participant "vehiclesDto\n:List<VehicleDto>" as VEHICLESDTO
participant "vehicleDto\n:VehicleDto" as VEHICLEDTO

activate GSM

    GSM -> UI : asks to assign one or more vehicle to an agenda entry
    activate UI

    UI -> CTRL** : create

    UI -> CTRL : getAgendaEntries()
    activate CTRL

        CTRL -> REP**: getInstance()
        activate REP

            REP --> CTRL: repositories
        deactivate REP

        CTRL -> REP: getAgenda()
        activate REP

            REP --> CTRL: agenda
        deactivate REP

        CTRL -> AGENDA** : getAgendaEntries()
        activate AGENDA

            AGENDA --> LISTENTRIES** : create()
            activate LISTENTRIES

                loop for each agendaEntry
                AGENDA -> AGENDAENTRY** : b = validateAgendaEntryToAssignTeam()

                    opt b == true
                    AGENDA -> LISTENTRIES : add(agendaEntry)
                    activate LISTENTRIES
                    deactivate LISTENTRIES
                    end

                end

                LISTENTRIES --> AGENDA : listEntries
            deactivate LISTENTRIES

            AGENDA --> CTRL : listEntries
            deactivate AGENDA

                CTRL -> AGENDAMAPPER** : agendaEntriesToDto(listEntries)
                activate AGENDAMAPPER

                    AGENDAMAPPER --> AGENDAENTRIESDTO** : create()

                    loop for each agendaEntry
                        AGENDAMAPPER -> LISTENTRIES : get(i)
                        activate LISTENTRIES

                            LISTENTRIES --> AGENDAMAPPER : agendaEntry
                        deactivate LISTENTRIES

                        AGENDAMAPPER -> AGENDAMAPPER : agendaEntryDto = toDTO(agendaEntry)
                        activate AGENDAMAPPER
                        deactivate AGENDAMAPPER

                        AGENDAMAPPER --> AGENDAENTRYDTO** : create()
                        activate AGENDAENTRYDTO

                            AGENDAENTRYDTO --> AGENDAMAPPER : agendaEntryDto
                        deactivate AGENDAENTRYDTO

                        AGENDAMAPPER -> AGENDAENTRIESDTO : add(agendaEntryDto)
                        activate AGENDAENTRIESDTO
                        deactivate AGENDAENTRIESDTO

                    end

                    AGENDAMAPPER --> CTRL : agendaEntriesDto
                deactivate AGENDAMAPPER

        CTRL --> UI : agendaEntriesDto
    deactivate CTRL

    UI --> GSM : shows all the agenda entries created and \nasks you to select one
    deactivate UI

    GSM -> UI : choose an agenda entry
    activate UI

    UI -> CTRL : getVehicleList(agendaEntryDto)
    activate CTRL

        CTRL -> REP: getInstance()
        activate REP

            REP --> CTRL: repositories
        deactivate REP

        CTRL -> REP: getVehicleRepository()
        activate REP

            REP --> CTRL: vehicleRepository
        deactivate REP

        CTRL -> CTRL : agendaEntry = toDomain(agendaEntryDto)
        activate CTRL
        deactivate CTRL

        CTRL -> VEHICLEREP** : getVehicleList(agendaEntry)
        activate VEHICLEREP

            VEHICLEREP --> LISTVEHICLE** : create()
            activate LISTVEHICLE

                loop for each vehicle
                    VEHICLEREP -> VEHICLE** : b = validateVehicleToAssign()
                    opt b == true
                        VEHICLEREP -> LISTVEHICLE : add(vehicle)
                        activate LISTVEHICLE
                        deactivate LISTVEHICLE
                    end

                end

                LISTVEHICLE --> VEHICLEREP : listVehicles
            deactivate LISTVEHICLE

                VEHICLEREP --> CTRL : listVehicles
            deactivate VEHICLEREP

        CTRL -> VEHICLEREPMAPPER** : vehiclesToDto(listVehicles)
        activate VEHICLEREPMAPPER

            VEHICLEREPMAPPER --> VEHICLESDTO** : create()

                loop for each vehicle
                    VEHICLEREPMAPPER -> LISTVEHICLE : get(i)
                    activate LISTVEHICLE

                        LISTVEHICLE --> VEHICLEREPMAPPER : vehicle
                    deactivate LISTVEHICLE

                    VEHICLEREPMAPPER -> VEHICLEREPMAPPER : vehicleDto = toDTO(vehicle)
                    activate VEHICLEREPMAPPER
                    deactivate VEHICLEREPMAPPER

                    VEHICLEREPMAPPER --> VEHICLEDTO** : create()
                    activate VEHICLEDTO

                        VEHICLEDTO --> VEHICLEREPMAPPER : vehicleDto
                    deactivate VEHICLEDTO

                    VEHICLEREPMAPPER -> VEHICLESDTO : add(vehicleDto)
                    activate VEHICLESDTO
                    deactivate VEHICLESDTO

                end

                VEHICLEREPMAPPER --> CTRL : vehiclesDto
            deactivate VEHICLEREPMAPPER

        CTRL --> UI : vehiclesDto
    deactivate CTRL

    UI --> GSM : shows all available vehicles and \nasks you to select one or more
    deactivate UI

    GSM -> UI : chooses one or more vehicles
    activate UI

        UI --> GSM : shows all data and requests confirmation
    deactivate UI

    GSM -> UI : confirms data
    activate UI

        UI -> CTRL : assignVehiclesToAgendaEntry(vehicleDto)
        activate CTRL

            CTRL -> CTRL : vehicle = toDomain(vehicleDto)
            activate CTRL
            deactivate CTRL

            CTRL -> AGENDA : assignVehicleToAgendaEntry(agendaEntry, vehicle)
            activate AGENDA

                AGENDA -> AGENDAENTRY : assignVehicle(vehicle)
                activate AGENDAENTRY

                    AGENDAENTRY -> VEHICLE : assignAgendaEntry()
                    activate VEHICLE

                        VEHICLE -> VEHICLE : blockVehicleAtATime()
                        activate VEHICLE
                        deactivate VEHICLE

                        VEHICLE --> AGENDAENTRY : operation success
                    deactivate VEHICLE

                    AGENDAENTRY --> AGENDA : operation success
                deactivate AGENDAENTRY

                AGENDA --> CTRL : operation success
            deactivate AGENDA

            CTRL --> UI : operation success
        deactivate CTRL

        UI --> GSM : displays operation success
    deactivate UI

deactivate GSM

@enduml