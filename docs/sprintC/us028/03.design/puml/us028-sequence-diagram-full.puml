@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

autonumber

actor "Collaborator" as Col
participant ":ListTaskSpaceUI" as UI
participant ":ListTaskController" as CTRL
participant ":ApplicationSession" as _APP
participant "appSession\n:ApplicationSession" as APP
participant "currentSession\n:UserSession" as SESSION
participant ":Repositories" as RepositorySingleton
participant "repositories\n:Repositories" as REP
participant "collaboratorRepository\n:CollaboratorRepository" as collaboratorRepository
participant "teamRepository\n:TeamRepository" as teamRepository
participant "teamList\n:List<Team>" as LISTTEAM
participant "team:Team" as TEAM
participant "taskRepository\n:TaskRepository" as taskRepository
participant "taskList\n:List<Task>" as LISTTASK
participant "agenda\n:Agenda" as AGENDA
participant "agendaEntry\n:AgendaEntry" as agendaEntry
participant "statusList\n:List<String>" as LISTSTATUS
participant ":AgendaEntryMapper" as Mapper
participant "listAgendaEntriesDto\n:List<AgendaEntryDto>" as ListAgendaEntriesDto
participant "agendaEntryDto\n:AgendaEntryDto" as DTO
participant "agendaEntries\n:List<AgendaEntry>" as AGENDAENTRIES

activate Col

Col -> UI : requests to consult tasks assigned to him
    activate UI

    UI -> CTRL** : create
    UI -> CTRL : getCollaboratorByEmail(email)
        activate CTRL

            CTRL -> CTRL : getCollaboratorFromSession(email)
            activate CTRL
           CTRL -> _APP**: getInstance()
           activate _APP

                _APP -> CTRL: appSession
           deactivate _APP

           CTRL -> APP**: getCurrentSession()
           activate APP

                APP --> CTRL: currentSession
           deactivate APP

           CTRL -> SESSION**: getUserEmail()
           activate SESSION

                SESSION --> CTRL: email
           deactivate SESSION

        CTRL -> RepositorySingleton : getInstance()
            activate RepositorySingleton

            RepositorySingleton --> CTRL : repositories
            deactivate RepositorySingleton

        CTRL -> REP : getCollaboratorRepository
            activate REP

            REP --> CTRL : collaboratorRepository
            deactivate REP

        CTRL -> collaboratorRepository : getCollaboratorByEmail(email)
            activate collaboratorRepository

            collaboratorRepository -> collaboratorRepository : getCollaboratorByEmail(email)
            activate collaboratorRepository

            collaboratorRepository --> CTRL : collaborator

                deactivate collaboratorRepository

            deactivate collaboratorRepository
        CTRL --> UI : collaborator
        deactivate CTRL

        deactivate CTRL
    UI --> Col : asks to select the beginning and end date of the search
    deactivate UI

Col -> UI : selects the beginning and end date
    activate UI

    UI -> CTRL : getStatusList()
        activate CTRL

        CTRL -> RepositorySingleton : getInstance()
            activate RepositorySingleton

            RepositorySingleton --> CTRL : repositories
            deactivate RepositorySingleton

        CTRL -> REP : getAgenda()
            activate REP

            REP --> CTRL : agenda
            deactivate REP

        CTRL -> AGENDA : getStatusList()
            activate AGENDA

            AGENDA -> LISTSTATUS** : create()
                    AGENDA -> agendaEntry : getStatusList()
                        activate agendaEntry

                            loop for each status in the system
                                agendaEntry -> LISTSTATUS : add(status)
                                activate LISTSTATUS
                            end
                        LISTSTATUS --> agendaEntry : statusList
                        deactivate LISTSTATUS
                    agendaEntry --> AGENDA : statusList
                    deactivate agendaEntry
        AGENDA --> CTRL : statusList
        deactivate AGENDA

        CTRL --> UI : statusList
        deactivate CTRL

    UI --> Col : asks to select the type of status he wants to consult
    deactivate UI

Col -> UI : Selects the type he wants to consult
    activate UI

    UI --> Col : asks for confirmation
    deactivate UI

Col -> UI : confirms that he wants to create the list
    activate UI

    UI -> CTRL : getTaskList(collaborator,dateI,dateF,typeStatus)
        activate CTRL

        CTRL -> RepositorySingleton : getInstance()
            activate RepositorySingleton

            RepositorySingleton --> CTRL : repositories
            deactivate RepositorySingleton

        CTRL -> REP : getTeamRepository()
            activate REP

            REP --> CTRL : teamRepository
            deactivate REP

        CTRL -> teamRepository : getTeamsThoughCollaborator(collaborator)
            activate teamRepository

            teamRepository -> LISTTEAM** : create()
                loop for each team in the system
                    teamRepository -> TEAM** : validateCollaboratorTeam(collaborator,team)
                        activate TEAM
                        TEAM -> TEAM : inTeam = validateCollaboratorTeam(collaborator,team)
                        activate TEAM

                        TEAM --> teamRepository : inTeam
                        deactivate TEAM

                        deactivate TEAM
                    opt inTeam == true
                        teamRepository -> LISTTEAM : addTeamOfCollaborator(team)
                            activate LISTTEAM
                    end

                end
            LISTTEAM --> teamRepository : teamList
            deactivate LISTTEAM
            teamRepository --> CTRL : teamList
            deactivate teamRepository

        CTRL -> RepositorySingleton : getInstance()
            activate RepositorySingleton

            RepositorySingleton --> CTRL : repositories
            deactivate RepositorySingleton

        CTRL -> REP : getTaskRepository()
            activate REP

            REP --> CTRL : taskRepository
            deactivate REP

        CTRL -> taskRepository : getTaskList(teamList,typeStatus)
            activate taskRepository

            taskRepository -> LISTTASK** : create()
                loop for each task in the system
                    loop for each team in the teamList
                    opt ((typeStatus() == task.getStatus()) && (team == task.getTeam()))
                        taskRepository -> LISTTASK : addTaskOfCollaborator(task)
                            activate LISTTASK
                    end

                    end

                end
            LISTTASK --> taskRepository : taskList
            deactivate LISTTASK

            taskRepository --> CTRL : taskList
        deactivate taskRepository

        CTRL -> RepositorySingleton : getInstance()
            activate RepositorySingleton

            RepositorySingleton --> CTRL : repositories
            deactivate RepositorySingleton

        CTRL -> REP : getAgenda()
            activate REP

            REP --> CTRL : Agenda
            deactivate REP

        CTRL -> AGENDA : getCollaboratorAgendaEntries(taskList,dateI,dateF)
            activate AGENDA

            AGENDA --> AGENDAENTRIES** : create()
                loop for each task
                    loop for each agendaEntry
                        opt (agendaEntry.getTask() == task && agendaEntry.getDate() >= dateI && agendaEntry.getDate() <= dateF)
                            AGENDA -> AGENDAENTRIES : add(agendaEntry)
                                activate AGENDAENTRIES
                        end
                    end
                end
            AGENDAENTRIES --> AGENDA : agendaEntryList
            deactivate AGENDAENTRIES
        AGENDA --> CTRL : agendaEntryList
        deactivate AGENDA

        CTRL -> Mapper : toDTOList(agendaEntryList)
            activate Mapper

            Mapper --> ListAgendaEntriesDto** : create()
                loop for each agendaEntry in agendaEntryList
                    Mapper -> AGENDAENTRIES : get(i)
                        activate AGENDAENTRIES

                        AGENDAENTRIES --> Mapper : agendaEntry
                        deactivate AGENDAENTRIES
                    Mapper -> DTO : toDTOEntry(agendaEntry)
                        activate DTO

                        DTO --> Mapper : agendaEntryDto
                        deactivate DTO
                    Mapper -> ListAgendaEntriesDto : add(agendaEntryDto)
                        activate ListAgendaEntriesDto
                end


            ListAgendaEntriesDto --> Mapper : agendaEntryListDto
             deactivate ListAgendaEntriesDto

             Mapper --> CTRL : agendaEntryListDto
            deactivate Mapper

        CTRL --> UI : agendaEntryListDto
        deactivate CTRL

    UI --> Col : shows the list of tasks
    deactivate UI

deactivate Col
@enduml
